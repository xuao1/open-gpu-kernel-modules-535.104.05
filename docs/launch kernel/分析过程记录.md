## 11-30

以下分析均基于 testkernel

### 1

重复：使用 cuda-gdb 在 launch kernel 附近加断点，记录其日志

发现：多次执行，日志基本一致

### 2 

在 kernel-open 下的所有函数的入口处打 log

除去部分后台一直执行的以及 poll 的两个函数，分析剩下的函数的具体功能

## 12-1

### 1

再次使用 cuda-gdb 运行 testkernel，launch kernel 的 log 和之前运行的结果高度一致

### 2 

分析被注释掉的函数的功能

### 3

沿着 ioctl 的路径分析：

kernel-open:

```c
printk(KERN_ERR "ioctl 3. nvidia_ioctl in nv.c cmd: %u, arg: %lu\n", _IOC_NR(cmd), i_arg);
```

src:

```c
NV_PRINTF(LEVEL_ERROR, "========================= xuao new 1. deviceCtrlCmdHostGetCapsV2_IMPL in kern_bus_ctrl.c\n");
```

在 nv-frontend.c，**标记为 1**

在 nv.c：**入口标记为 2**

+ 非 default，**标记为 3**
+ default，**标记为 4**

在 osapi.c，**标记为 5**

在 escape.c，**入口标记为 6**

+ 非 default，**标记为 7**
+ default，**标记为 8**

重复运行 cuda-gdb 3 次，查看 launch kernel 的 log，3 次运行完全一致

62 次 ioctl 的调用均为 1-2-4-5-6-7

所以只保留 7 的 log 输出，重新运行（为了方便分析）

只保留 `NV_ESC_RM_CONTROL` 的 7，同时在 `NV_ESC_RM_CONTROL` 内部，分别打 log，看 if 是否进入，**标记为 9**
